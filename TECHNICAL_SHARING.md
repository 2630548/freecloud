# FreeCloud 自动续费系统 - 技术分享文档

> ⚠️ **服务已停止运行** - 本项目现已转为技术分享，不再提供在线服务

## 📋 项目概述

这是一个完整的分布式自动续费系统，展示了如何使用 Cloudflare Workers 构建高可用的云原生应用。项目包含前端客户端、后端API、管理系统等完整架构。

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端客户端     │───▶│   WorkerA (URL1) │───▶│   WorkerB (管理) │
│   (fcrenew.js)  │    │   请求转发/验证   │    │   API Key管理   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   URL2 服务群   │
                       │   (实际续费)    │
                       └─────────────────┘
```

### 核心组件

#### 1. **前端客户端 (fcrenew.js)**
- 用户界面和交互逻辑
- API Key 验证
- 续费请求发送
- 结果展示和错误处理

#### 2. **WorkerA (URL1) - 请求转发层**
- API Key 验证和权限检查
- 版本控制和兼容性检查
- 请求转发和负载均衡
- 安全控制和频率限制

#### 3. **WorkerB - 管理系统**
- 用户和API Key管理
- 使用统计和数据分析
- 管理后台界面
- GitHub Star状态检测

#### 4. **URL2 服务群 - 处理层**
- 实际的续费逻辑处理
- 验证码处理 (技术细节未公开)
- CF挑战绕过 (技术细节未公开)

## 🛠️ 技术栈

- **前端**: 原生JavaScript + HTML/CSS
- **后端**: Cloudflare Workers + D1 Database  
- **数据库**: SQLite (Cloudflare D1)
- **部署**: Cloudflare Workers 平台
- **监控**: 自建日志系统

## 📁 项目结构

```
freecloud-web/
├── freecloud/              # 前端客户端 (已公开)
│   ├── fcrenew.js          # 续费脚本
│   └── README.md           # 使用说明
├── workerA/                # URL1服务 (部分公开)
│   ├── 请求转发逻辑        # 将公开
│   ├── API Key验证         # 将公开
│   ├── 版本控制           # 将公开
│   └── [核心算法]         # 不公开
├── workerB/                # 管理系统 (将公开)
│   ├── 用户管理API        # 将公开
│   ├── 统计分析           # 将公开
│   ├── 前端界面           # 将公开
│   └── 数据库设计         # 将公开
└── 部署配置               # 将公开
```

## 🔧 核心技术实现

### 1. API Key 系统设计

**数据库结构**:
```sql
CREATE TABLE keys (
    key_id TEXT PRIMARY KEY,
    status TEXT DEFAULT 'active',
    max_accounts INTEGER DEFAULT 1,
    max_uses INTEGER DEFAULT 0,
    used_count INTEGER DEFAULT 0,
    github_username TEXT,
    is_starred INTEGER DEFAULT 0,
    created_time TEXT,
    expiry_time TEXT
);
```

**验证流程**:
1. 客户端发送API Key
2. WorkerA验证Key有效性
3. 检查使用次数和权限
4. 转发请求到URL2服务

### 2. 分布式架构设计

**负载均衡策略**:
- URL2服务群轮询分配
- 故障自动切换
- 健康检查机制

**数据一致性**:
- 使用Cloudflare D1保证数据一致性
- 分布式锁防止并发问题
- 事务处理保证数据完整性

### 3. 安全机制

**多层验证**:
- API Key验证
- 版本控制检查
- 请求频率限制
- GitHub Star状态验证

**数据保护**:
- 敏感数据加密传输
- 不存储用户密码
- 定期清理日志数据

## 📊 管理系统功能

### 用户管理
- API Key的创建、编辑、删除
- 用户权限分级管理
- 批量操作支持

### 数据统计
- 实时使用统计
- 成功率分析
- 用户活跃度监控

### 日志系统
- 完整的操作日志
- 错误追踪和分析
- 自动日志清理

### Star管理
- GitHub Star状态自动检测
- 权限自动升级/降级
- 批量状态更新

## 🚀 部署指南

### 环境准备
1. Cloudflare 账号
2. GitHub Token (用于Star验证)
3. D1 数据库实例

### 部署步骤
1. 创建Cloudflare Workers
2. 配置D1数据库
3. 设置环境变量
4. 部署Worker代码
5. 配置自定义域名

## ⚠️ 重要说明

### 服务状态
- ❌ 在线服务已停止
- ✅ 代码开源分享
- ✅ 技术文档完整
- ✅ 可用于学习研究

### 技术保护
出于技术保护考虑，以下核心算法不公开：
- 🔒 验证码识别和处理算法
- 🔒 数学验证题解算法
- 🔒 Cloudflare挑战绕过方法
- 🔒 具体的目标站点接口调用

### 开源范围
将公开以下技术实现：
- ✅ 完整的系统架构设计
- ✅ API Key管理系统
- ✅ 用户权限控制
- ✅ 数据统计和日志系统
- ✅ 前端管理界面
- ✅ 部署和配置方法

## 🎯 学习价值

### 适合学习的技术点
1. **Cloudflare Workers 开发**
   - Serverless 架构设计
   - 边缘计算应用
   - D1 数据库使用

2. **分布式系统设计**
   - 负载均衡实现
   - 故障转移机制
   - 数据一致性保证

3. **用户权限系统**
   - API Key 设计
   - 权限分级管理
   - 第三方集成 (GitHub)

4. **前端开发**
   - 原生JavaScript应用
   - 响应式界面设计
   - 数据可视化

## 📄 许可证

MIT License - 仅限学习和研究用途

## 🙏 致谢

感谢所有使用过本服务的用户，以及为项目发展提供建议的开发者们。虽然服务已停止，但希望这些技术分享能对大家的学习和工作有所帮助。

---

> 💡 **下一步**: 我将逐步公开可分享的代码部分，包括管理系统、API设计、数据库结构等，供大家学习参考。
